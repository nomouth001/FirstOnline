{% extends "base.html" %}

{% block title %}ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h2>ğŸ“‹ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬</h2>
        {% if current_user.is_administrator() %}
            <a href="{{ url_for('user_stock.create_stock_list') }}" class="btn btn-success">â• ìƒˆ ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°</a>
        {% endif %}
    </div>
    <p>ì¢…ëª© ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”. ê° ë¦¬ìŠ¤íŠ¸ì— ì¢…ëª©ì„ ì¶”ê°€í•˜ì—¬ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</div>

<div class="card">
    <h3>ğŸ“Š ë‚´ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ({{ stock_lists|length }}ê°œ)</h3>
    
    {% if stock_lists %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1rem;">
            {% for stock_list in stock_lists %}
                <div style="border: 1px solid #ddd; border-radius: 8px; padding: 1rem; background: white;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                        <h4 style="margin: 0;">{{ stock_list.name }}</h4>
                        {% if stock_list.is_default %}
                            <span style="background: #007bff; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem;">ê¸°ë³¸</span>
                        {% endif %}
                    </div>
                    
                    {% if stock_list.description %}
                        <p style="color: #666; margin-bottom: 0.5rem; font-size: 0.9rem;">{{ stock_list.description }}</p>
                    {% endif %}
                    
                    <p style="margin-bottom: 1rem; font-size: 0.9rem;">
                        <strong>ì¢…ëª© ìˆ˜:</strong> {{ stock_list.stocks|length }}ê°œ
                        {% if stock_list.is_public %}
                            <span style="background: #28a745; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-left: 0.5rem;">ê³µê°œ</span>
                        {% endif %}
                    </p>
                    
                    <p style="margin-bottom: 1rem; font-size: 0.8rem; color: #666;">
                        ìƒì„±ì¼: {{ stock_list.created_at.strftime('%Y-%m-%d %H:%M') }}
                    </p>
                    
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <a href="{{ url_for('user_stock.view_stock_list', list_id=stock_list.id) }}" 
                           class="btn btn-primary btn-sm">ë³´ê¸°</a>
                        <a href="{{ url_for('user_stock.edit_stock_list', list_id=stock_list.id) }}" 
                           class="btn btn-success btn-sm">ìˆ˜ì •</a>
                        <a href="{{ url_for('user_stock.add_stock', list_id=stock_list.id) }}" 
                           class="btn btn-info btn-sm">ì¢…ëª© ì¶”ê°€</a>
                        
                        <form method="POST" action="{{ url_for('user_stock.delete_stock_list', list_id=stock_list.id) }}" 
                              style="display: inline;">
                            <button type="submit" class="btn btn-danger btn-sm" 
                                    onclick="return confirm('ì •ë§ ì´ ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në¦¬ìŠ¤íŠ¸ëª…: {{ stock_list.name }}\nì¢…ëª© ìˆ˜: {{ stock_list.stocks|length }}ê°œ')">ì‚­ì œ</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 2rem; color: #666;">
            <p>ì•„ì§ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% if current_user.is_administrator() %}
                <a href="{{ url_for('user_stock.create_stock_list') }}" class="btn btn-success">ì²« ë²ˆì§¸ ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°</a>
            {% endif %}
        </div>
    {% endif %}
</div>

<div class="card">
    <h3>ğŸš€ ë¹ ë¥¸ ì‘ì—…</h3>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        {% if current_user.is_administrator() %}
            <a href="{{ url_for('user_stock.create_stock_list') }}" class="btn btn-success">â• ìƒˆ ë¦¬ìŠ¤íŠ¸</a>
        {% endif %}
        <a href="{{ url_for('user_stock.dashboard') }}" class="btn btn-primary">ëŒ€ì‹œë³´ë“œ</a>
        <a href="{{ url_for('summary_page') }}" class="btn btn-info">ë¶„ì„ ìš”ì•½</a>
        <button type="button" class="btn btn-warning" onclick="cleanupDuplicateLists()">ğŸ§¹ ì¤‘ë³µ ë¦¬ìŠ¤íŠ¸ ì •ë¦¬</button>
    </div>
</div>

<script>
function cleanupDuplicateLists() {
    if (confirm('ì¤‘ë³µëœ ë¦¬ìŠ¤íŠ¸ë¥¼ ì •ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në™ì¼í•œ ì´ë¦„ì˜ ë¦¬ìŠ¤íŠ¸ê°€ ì—¬ëŸ¬ ê°œ ìˆëŠ” ê²½ìš°, ê°€ì¥ ìµœê·¼ ê²ƒë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” ì‚­ì œë©ë‹ˆë‹¤.\nì¢…ëª©ì€ ìµœì‹  ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™ë©ë‹ˆë‹¤.')) {
        fetch('{{ url_for("user_stock.cleanup_duplicate_lists") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`ì¤‘ë³µ ë¦¬ìŠ¤íŠ¸ ì •ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nì‚­ì œëœ ë¦¬ìŠ¤íŠ¸: ${data.deleted_count}ê°œ`);
                location.reload();
            } else {
                alert('ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + data.error);
            }
        })
        .catch(error => {
            alert('ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error);
        });
    }
}
</script>
{% endblock %} 